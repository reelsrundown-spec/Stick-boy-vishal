<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>Ninja Combat 3D Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #game-ui { position: absolute; top: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .header { position: absolute; top: 0; width: 100%; height: 40px; background: rgba(0,0,0,0.6); color: white; display: flex; justify-content: space-around; align-items: center; }
        .hp-bar { width: 120px; height: 12px; background: #444; border: 2px solid #fff; border-radius: 6px; overflow: hidden; }
        #hp-fill { height: 100%; background: #2ecc71; width: 100%; transition: 0.3s; }
        .controls { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 50px; box-sizing: border-box; }
        .btn-group { display: flex; gap: 15px; pointer-events: auto; }
        button { width: 70px; height: 70px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); background: rgba(50,50,50,0.8); color: white; font-weight: bold; font-size: 12px; touch-action: manipulation; }
        button:active { background: #ed4c67; transform: scale(0.9); }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.85); color: white; z-index: 100; display: none; }
        #start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #1e272e; color: white; z-index: 101; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1>NINJA COMBAT 3D</h1>
    <button id="start-btn" style="width: 120px; height: 120px; background: #ed4c67; border: none; font-size: 18px;">START</button>
</div>

<div id="game-ui">
    <div class="header">
        <div>HP <div class="hp-bar"><div id="hp-fill"></div></div></div>
        <div id="lvl">LEVEL 1</div>
        <div id="score">SCORE: 0</div>
    </div>
    <div id="overlay">
        <h1 id="status-msg">നീ ചാത്തട!</h1>
        <button id="action-btn" style="padding: 15px 40px; border-radius: 30px; background: #ed4c67; color: white; border: none; font-weight: bold; pointer-events: auto;">CONTINUE</button>
    </div>
    <div class="controls">
        <div class="btn-group">
            <button id="lBtn">LEFT</button>
            <button id="rBtn">RIGHT</button>
            <button id="jBtn" style="background: #0984e3;">JUMP</button>
        </div>
        <div class="btn-group">
            <button id="pBtn" style="background: #c0392b;">PUNCH</button>
            <button id="sBtn" style="background: #f1c40f; color: black;">SWORD</button>
            <button id="gBtn" style="background: #27ae60;">GUN</button>
        </div>
    </div>
</div>

<script>
    // 3D Engine Variables
    let scene, camera, renderer, player, floor;
    let enemies = [], bullets = [];
    let isStarted = false, isPaused = false, hp = 300, level = 1, score = 0;

    function init3D() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1e272e);
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Lighting
        const light = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(light);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(5, 10, 7);
        scene.add(directionalLight);

        // Floor
        const floorGeo = new THREE.BoxGeometry(100, 1, 10);
        const floorMat = new THREE.MeshPhongMaterial({ color: 0x2c3e50 });
        floor = new THREE.Mesh(floorGeo, floorMat);
        floor.position.y = -1;
        scene.add(floor);

        // Player (Ninja 3D Model)
        const playerGeo = new THREE.BoxGeometry(0.8, 1.8, 0.8);
        const playerMat = new THREE.MeshPhongMaterial({ color: 0x3498db });
        player = new THREE.Mesh(playerGeo, playerMat);
        player.dy = 0; player.dir = 1;
        scene.add(player);

        camera.position.z = 8;
        camera.position.y = 2;
    }

    function spawnEnemies() {
        enemies.forEach(e => scene.remove(e));
        enemies = [];
        for(let i=0; i<level; i++) {
            const enemyGeo = new THREE.BoxGeometry(0.8, 1.8, 0.8);
            const enemyMat = new THREE.MeshPhongMaterial({ color: 0xe74c3c });
            let enemy = new THREE.Mesh(enemyGeo, enemyMat);
            enemy.position.x = 5 + (i * 3);
            enemy.hp = 250;
            scene.add(enemy);
            enemies.push(enemy);
        }
    }

    function animate() {
        if(!isStarted || isPaused) return;
        requestAnimationFrame(animate);

        // Player Jump Physics
        player.position.y += player.dy;
        if(player.position.y > 0) player.dy -= 0.02;
        else { player.position.y = 0; player.dy = 0; }

        // Camera Follow
        camera.position.x += (player.position.x - camera.position.x) * 0.1;

        // Bullets Move
        bullets.forEach((b, index) => {
            b.position.x += b.dx;
            enemies.forEach(enemy => {
                if(b.position.distanceTo(enemy.position) < 1) {
                    enemy.hp -= 50;
                    scene.remove(b);
                    bullets.splice(index, 1);
                    if(enemy.hp <= 0) { scene.remove(enemy); enemy.dead = true; score+=100; document.getElementById("score").innerText = "SCORE: " + score; }
                }
            });
            if(Math.abs(b.position.x) > 50) { scene.remove(b); bullets.splice(index, 1); }
        });

        // Check Win/Lose
        if(enemies.every(e => e.dead || !e.parent)) showOverlay("WIN");
        if(hp <= 0) showOverlay("LOSE");

        renderer.render(scene, camera);
    }

    function showOverlay(state) {
        isPaused = true;
        document.getElementById("overlay").style.display = "flex";
        document.getElementById("status-msg").innerText = (state === "WIN") ? "നീ ചാത്തട!" : "നക്കിക്കോ!";
        document.getElementById("action-btn").innerText = (state === "WIN") ? "CONTINUE" : "RETRY";
    }

    // Controls
    document.getElementById("start-btn").onclick = () => {
        document.getElementById("start-screen").style.display = "none";
        isStarted = true;
        init3D();
        spawnEnemies();
        animate();
    };

    document.getElementById("lBtn").ontouchstart = () => { player.position.x -= 0.5; player.dir = -1; };
    document.getElementById("rBtn").ontouchstart = () => { player.position.x += 0.5; player.dir = 1; };
    document.getElementById("jBtn").ontouchstart = () => { if(player.position.y === 0) player.dy = 0.3; };
    document.getElementById("gBtn").ontouchstart = () => {
        const bGeo = new THREE.SphereGeometry(0.1);
        const bMat = new THREE.MeshBasicMaterial({ color: 0xffff00 });
        let b = new THREE.Mesh(bGeo, bMat);
        b.position.set(player.position.x, player.position.y + 0.5, 0);
        b.dx = 0.3 * player.dir;
        scene.add(b);
        bullets.push(b);
    };

    document.getElementById("action-btn").onclick = () => {
        if(document.getElementById("action-btn").innerText === "RETRY") location.reload();
        else { level++; hp = 300; isPaused = false; document.getElementById("overlay").style.display = "none"; spawnEnemies(); animate(); }
    };
</script>
</body>
</html>
