<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>Ninja Adventure Pro</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #87CEEB; font-family: sans-serif; }
        canvas { display: block; background: linear-gradient(#87CEEB, #E0F7FA); }
        .ui { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-around; color: #2c3e50; font-weight: bold; pointer-events: none; z-index: 10; }
        .controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-between; padding: 0 50px; box-sizing: border-box; z-index: 10; }
        .btn-group { display: flex; gap: 20px; pointer-events: auto; }
        button { width: 80px; height: 80px; border-radius: 50%; border: none; background: rgba(255,255,255,0.8); color: #333; font-weight: bold; touch-action: manipulation; box-shadow: 0 4px #999; font-size: 14px; }
        button:active { box-shadow: 0 0 #999; transform: translateY(4px); background: #eee; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: white; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
    </style>
</head>
<body>

<div class="ui">
    <div>COINS: <span id="coin-count">0</span></div>
    <div>HP: <span id="hp-val">100</span></div>
</div>

<div id="overlay">
    <h1 id="msg">നക്കിക്കോ!</h1>
    <button onclick="location.reload()" style="width: auto; padding: 15px 40px; border-radius: 30px; background: #ed4c67; color: white; border: none; font-weight: bold;">RETRY</button>
</div>

<canvas id="gameCanvas"></canvas>

<div class="controls">
    <div class="btn-group">
        <button id="lBtn">LEFT</button>
        <button id="rBtn">RIGHT</button>
    </div>
    <div class="btn-group">
        <button id="jBtn" style="background:#3498db; color:white;">JUMP</button>
        <button id="aBtn" style="background:#e74c3c; color:white;">ATTACK</button>
    </div>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let coins = 0;

    // Loading Character Image
    const ninjaImg = new Image();
    ninjaImg.src = "1000066473.gif"; 

    const p = { x: 100, y: 300, w: 75, h: 75, dx: 0, dy: 0, ground: false, dir: 1 };
    
    // Platforms layout
    const platforms = [
        { x: 0, y: 550, w: 500, h: 60 },    
        { x: 550, y: 450, w: 250, h: 40 },  
        { x: 300, y: 320, w: 250, h: 40 },  
        { x: 750, y: 250, w: 400, h: 40 }   
    ];

    const coinItems = [
        { x: 350, y: 280, collected: false },
        { x: 650, y: 410, collected: false },
        { x: 900, y: 210, collected: false }
    ];

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw Platforms
        ctx.fillStyle = "#795548";
        platforms.forEach(plat => {
            ctx.fillRect(plat.x, plat.y, plat.w, plat.h);
            ctx.fillStyle = "#4CAF50"; 
            ctx.fillRect(plat.x, plat.y, plat.w, 12);
        });

        // Draw Coins
        ctx.fillStyle = "#FFD700";
        coinItems.forEach(c => {
            if(!c.collected) {
                ctx.beginPath();
                ctx.arc(c.x, c.y, 12, 0, Math.PI*2);
                ctx.fill();
            }
        });

        // Draw Ninja
        ctx.save();
        if(p.dir === -1) {
            ctx.scale(-1, 1);
            ctx.drawImage(ninjaImg, -p.x - p.w, p.y, p.w, p.h);
        } else {
            ctx.drawImage(ninjaImg, p.x, p.y, p.w, p.h);
        }
        ctx.restore();

        update();
        requestAnimationFrame(draw);
    }

    function update() {
        p.dy += 0.8; 
        p.x += p.dx;
        p.y += p.dy;
        p.ground = false;

        platforms.forEach(plat => {
            if(p.x < plat.x + plat.w && p.x + p.w > plat.x &&
               p.y + p.h > plat.y && p.y + p.h < plat.y + 25) {
                p.y = plat.y - p.h;
                p.dy = 0;
                p.ground = true;
            }
        });

        coinItems.forEach(c => {
            if(!c.collected && Math.abs(p.x + p.w/2 - c.x) < 40 && Math.abs(p.y + p.h/2 - c.y) < 40) {
                c.collected = true;
                coins++;
                document.getElementById("coin-count").innerText = coins;
            }
        });

        // Game Over message
        if(p.y > canvas.height) { 
            document.getElementById("overlay").style.display = "flex";
        }
    }

    const setBtn = (id, start, end) => {
        const b = document.getElementById(id);
        const handleStart = (e) => { e.preventDefault(); start(); };
        const handleEnd = (e) => { e.preventDefault(); end(); };
        b.ontouchstart = handleStart;
        b.ontouchend = handleEnd;
        b.onmousedown = handleStart;
        b.onmouseup = handleEnd;
    };

    // Movement on Left Side
    setBtn("lBtn", () => { p.dx = -8; p.dir = -1; }, () => p.dx = 0);
    setBtn("rBtn", () => { p.dx = 8; p.dir = 1; }, () => p.dx = 0);
    // Actions on Right Side
    setBtn("jBtn", () => { if(p.ground) p.dy = -18; }, () => {});
    setBtn("aBtn", () => { console.log("Attack!"); }, () => {});

    window.onload = () => { resize(); draw(); };
    window.onresize = resize;
</script>
</body>
</html>
